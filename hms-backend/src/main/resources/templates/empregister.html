<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Employee Registration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="bg-light">

<div class="container my-5">
    <div class="card shadow-lg border-0 rounded-4">
        <div class="card-header bg-primary text-white text-center rounded-top-4">
            <h3 class="mb-0">Employee Registration Form</h3>
        </div>
        <div class="card-body p-4">

            <!-- Success message -->
            <div th:if="${message}" class="alert alert-success text-center" th:text="${message}"></div>

            <form th:action="@{/register}" th:object="${emp}" method="post" class="row g-3">

                <!-- Basic Info -->
                <h5 class="text-primary fw-bold">Basic Information</h5>
                <div class="col-md-6">
                    <label class="form-label">First Name</label>
                    <input type="text" th:field="*{firstName}" class="form-control" required />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Last Name</label>
                    <input type="text" th:field="*{lastName}" class="form-control" required />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Mobile No</label>
                    <input type="tel" th:field="*{mobileNumber}" class="form-control" required />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Profile Picture</label>
                    <input type="file" class="form-control" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Gender</label>
                    <select th:field="*{gender}" class="form-select">
                        <option value="MALE">Male</option>
                        <option value="FEMALE">Female</option>
                        <option value="TRANSGENDER">Transgender</option>
                        <option value="OTHER">Other</option>
                    </select>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Date of Birth</label>
                    <input type="date" th:field="*{dob}" class="form-control" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Age</label>
                    <input type="text" th:field="*{age}" class="form-control" id="age" readonly />
                </div>

                <!-- Account Details -->
                <h5 class="text-primary fw-bold mt-4">Account Details</h5>

                <div class="col-md-6">
                    <label class="form-label">Username</label>
                    <input type="text" th:field="*{userRegistrationDto.username}" class="form-control" required />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Email</label>
                    <input type="email" th:field="*{userRegistrationDto.email}" class="form-control" required />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Password</label>
                    <input type="password" th:field="*{userRegistrationDto.password}" class="form-control" required />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" th:field="*{userRegistrationDto.confirmPassword}" class="form-control" required />
                </div>

                <!-- ID Proof -->
                <h5 class="text-primary fw-bold mt-4">Identity Proof</h5>
                <div class="col-md-6">
                    <label class="form-label">ID Proof Type</label>
                    <select class="form-select" th:field="*{idProofName}">
                        <option value="AADHAR">Aadhar Card</option>
                        <option value="PAN">PAN Card</option>
                        <option value="PASSPORT">Passport</option>
                        <option value="DRIVING_LICENSE">Driving License</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Upload ID Proof</label>
                    <input type="file" class="form-control" />
                </div>

                <!-- Job Info -->
                <h5 class="text-primary fw-bold mt-4">Job Information</h5>
                <div class="col-md-6">
                    <label class="form-label">Blood Group</label>
                    <select th:field="*{bloodGroup}" class="form-select">
                        <option value="A_POS">A+</option>
                        <option value="A_NEG">A-</option>
                        <option value="B_POS">B+</option>
                        <option value="B_NEG">B-</option>
                        <option value="O_POS">O+</option>
                        <option value="O_NEG">O-</option>
                        <option value="AB_POS">AB+</option>
                        <option value="AB_NEG">AB-</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Joining Date</label>
                    <input type="date" th:field="*{joiningDate}" class="form-control" />
                </div>

                <!-- Address -->
                <h5 class="text-primary fw-bold mt-4">Address</h5>
                <div class="col-md-6">
                    <label class="form-label">Address Line 1</label>
                    <input type="text" th:field="*{address.addressLine1}" class="form-control" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Address Line 2</label>
                    <input type="text" th:field="*{address.addressLine2}" class="form-control" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">City</label>
                    <input type="text" th:field="*{address.city}" class="form-control" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">District</label>
                    <input type="text" th:field="*{address.district}" class="form-control" />
                    </div>
                <div class="col-md-3">
                    <label class="form-label">State</label>
                    <input type="text" th:field="*{address.state}" class="form-control" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Pincode</label>
                    <input type="text" th:field="*{address.pincode}" class="form-control" />
                </div>

                <!-- Role -->
                <h5 class="text-primary fw-bold mt-4">Role</h5>
                <div class="col-md-6">
                    <label class="form-label">Select Role</label>
                    <select id="role" th:field="*{roleId}" class="form-select">
                        <option value="">Select Role</option>
                        <th:block th:each="role : ${roles}">
                            <option th:value="${role.roleId}" th:text="${#strings.substring(role.roleName, 5)}"></option>
                        </th:block>
                    </select>
                </div>

                <!-- Dynamic Role Section -->
                <div id="roleFields" class="col-12 mt-3" style="display:none;">
                    <h5 id="roleHeader" class="text-success fw-bold"></h5>

                    <!-- Doctor fields -->
                    <div id="doctorFields" style="display:none;">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Department</label>
                                <select th:field="*{doctorDetails.departmentId}" class="form-select">
                                    <option value="">Select Department</option>
                                    <th:block th:each="dept : ${departments}">
                                        <option th:value="${dept.id}" th:text="${dept.department_name}"></option>
                                    </th:block>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Specialization</label>
                                <select class="form-select" th:field="*{doctorDetails.specialization}">
                                    <option value="GENERAL">General</option>
                                    <option value="PEDIATRIC">Pediatric</option>
                                    <option value="SURGICAL">Surgical</option>
                                </select>

                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Experience</label>
                                <select class="form-select" th:field="*{doctorDetails.experience}">
                                    <option value="LESS_THAN_ONE">Less than one year</option>
                                    <option value="ONE_TO_THREE">1-3 years</option>
                                    <option value="THREE_TO_FIVE">3-5 years</option>
                                    <option value="FIVE_PLUS">5+ years</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Qualifications</label>
                                <input type="text" th:field="*{doctorDetails.qualifications}"
                                       class="form-control" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">License Number</label>
                            <input type="text" th:field="*{doctorDetails.licenseNumber}" class="form-control" />
                        </div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-success px-5">Register</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Auto-calc age
    document.getElementById("dob").addEventListener("change", function () {
        let dob = new Date(this.value);
        let today = new Date();
        let age = today.getFullYear() - dob.getFullYear();
        let m = today.getMonth() - dob.getMonth();
        if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
            age--;
        }
        document.getElementById("age").value = age;
    });

    // Role-based toggle
    document.addEventListener("DOMContentLoaded", function () {
        const roleSelect = document.getElementById("role");
        const roleFields = document.getElementById("roleFields");
        const roleHeader = document.getElementById("roleHeader");

        const doctorFields = document.getElementById("doctorFields");

        function toggleFields() {
            doctorFields.style.display = "none";
            roleFields.style.display = "none";

            const selectedRole = roleSelect.options[roleSelect.selectedIndex]?.text;
            if (selectedRole && selectedRole !== "Select Role") {
                roleFields.style.display = "block";
                roleHeader.textContent = selectedRole + " Details";
            }

            if (selectedRole === "DOCTOR") {
                doctorFields.style.display = "block";
            }
        }

        roleSelect.addEventListener("change", toggleFields);
        toggleFields();
    });
</script>
</body>
</html>